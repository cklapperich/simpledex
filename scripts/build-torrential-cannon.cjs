#!/usr/bin/env node
/**
 * Build the "Torrential Cannon" theme deck (Team Up) in PTCGO format.
 *
 * Looks up each card in cards-western.json by name, set, and number
 * to find the correct ptcgoCode, then outputs the formatted decklist.
 *
 * Saves to: decklists/torrential-cannon.txt
 */

const path = require('path');
const fs = require('fs');
const cards = require(path.join(__dirname, '..', 'dist', 'cards-western.json'));

// Helper: find a card by exact English name, set name, and card number
function findCard(name, setName, number) {
  const match = cards.find(c => {
    const cardName = c.names?.en || c.name || '';
    return cardName === name && c.set === setName && c.number === String(number);
  });
  if (!match) {
    console.error(`WARNING: Could not find card: ${name} | ${setName} | ${number}`);
    return null;
  }
  return match;
}

// Helper: format a PTCGO line
function ptcgoLine(qty, card) {
  const name = card.names?.en || card.name || '???';
  const code = card.ptcgoCode || card.set;
  const num = card.number;
  return `* ${qty} ${name} ${code} ${num}`;
}

// ── Deck Definition (from Bulbapedia) ──────────────────────────────
// Pokemon section
const pokemon = [
  { qty: 2, name: 'Blastoise',    set: 'Team Up',         num: '25'  },
  { qty: 2, name: 'Wartortle',    set: 'Team Up',         num: '24'  },
  { qty: 3, name: 'Squirtle',     set: 'Team Up',         num: '23'  },
  { qty: 2, name: 'Golduck',      set: 'Team Up',         num: '27'  },
  { qty: 3, name: 'Psyduck',      set: 'Team Up',         num: '26'  },
  { qty: 2, name: 'Pidgeot',      set: 'Team Up',         num: '124' },
  { qty: 2, name: 'Pidgeotto',    set: 'Team Up',         num: '123' },
  { qty: 3, name: 'Pidgey',       set: 'Team Up',         num: '121' },
  { qty: 3, name: "Farfetch\u2019d", set: 'Team Up',      num: '127' },
];

// Trainer section
const trainers = [
  { qty: 2, name: "Brock\u2019s Grit",   set: 'Team Up',         num: '135' },
  { qty: 2, name: 'Copycat',           set: 'Celestial Storm',  num: '127' },
  { qty: 2, name: 'Cynthia',           set: 'Ultra Prism',      num: '119' },
  { qty: 2, name: 'Hau',               set: 'Celestial Storm',  num: '132' },
  { qty: 2, name: 'Nest Ball',         set: 'Sun & Moon',       num: '123' },
  { qty: 2, name: 'Pok\u00e9mon Fan Club', set: 'Ultra Prism',  num: '133' },
  { qty: 2, name: 'Professor Kukui',   set: 'Sun & Moon',       num: '128' },
  { qty: 2, name: 'Switch',            set: 'Celestial Storm',  num: '147' },
  { qty: 2, name: 'Timer Ball',        set: 'Sun & Moon',       num: '134' },
];

// ── Build the decklist ─────────────────────────────────────────────
const lines = [];
let totalCards = 0;

// Pokemon
lines.push('****** Pok\u00e9mon Trading Card Game Deck List ******');
lines.push('');
lines.push('##Pok\u00e9mon - 22');
lines.push('');

for (const entry of pokemon) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Trainers
lines.push('');
lines.push('##Trainer Cards - 18');
lines.push('');

for (const entry of trainers) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Energy
lines.push('');
lines.push('##Energy - 20');
lines.push('');
lines.push('* 20 Water Energy SUM 166');
totalCards += 20;

lines.push('');
lines.push('Total Cards - ' + totalCards);
lines.push('');
lines.push('****** Deck List Generated by SimpleDex ******');
lines.push('');

const output = lines.join('\n');
console.log(output);

// Save to file
const outPath = path.join(__dirname, '..', 'decklists', 'torrential-cannon.txt');
fs.mkdirSync(path.dirname(outPath), { recursive: true });
fs.writeFileSync(outPath, output, 'utf8');
console.log(`\nSaved to: ${outPath}`);
