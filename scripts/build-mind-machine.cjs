#!/usr/bin/env node
/**
 * Build the "Mind Machine" theme deck (Skyridge) in PTCGO format.
 *
 * NOTE: This deck is from Skyridge (2003), not EX Hidden Legends.
 *
 * Looks up each card in cards-western.json by name, set, and number
 * to find the correct ptcgoCode, then outputs the formatted decklist.
 *
 * Saves to: decklists/mind-machine.txt
 */

const path = require('path');
const fs = require('fs');
const cards = require(path.join(__dirname, '..', 'dist', 'cards-western.json'));

// Helper: find a card by exact English name, set name, and card number
function findCard(name, setName, number) {
  const match = cards.find(c => {
    const cardName = c.names?.en || c.name || '';
    return cardName === name && c.set === setName && c.number === String(number);
  });
  if (!match) {
    console.error(`WARNING: Could not find card: ${name} | ${setName} | ${number}`);
    return null;
  }
  return match;
}

// Helper: format a PTCGO line
function ptcgoLine(qty, card) {
  const name = card.names?.en || card.name || '???';
  const code = card.ptcgoCode || card.set;
  const num = card.number;
  return `* ${qty} ${name} ${code} ${num}`;
}

// ── Deck Definition (Mind Machine - Skyridge) ──────────────────────
// Pokemon section
const pokemon = [
  { qty: 3, name: 'Xatu',     set: 'Skyridge', num: '35'  },  // Rare
  { qty: 4, name: 'Natu',     set: 'Skyridge', num: '80'  },  // Common
  { qty: 2, name: 'Snorlax',  set: 'Skyridge', num: '100' },  // Common
  { qty: 2, name: 'Raticate', set: 'Skyridge', num: '89'  },  // Common
  { qty: 4, name: 'Rattata',  set: 'Skyridge', num: '90'  },  // Common
  { qty: 4, name: 'Ditto',    set: 'Skyridge', num: '51'  },  // Common
];

// Trainer section - includes cards from earlier E-Card sets
const trainers = [
  { qty: 2, name: 'Miracle Sphere Alpha', set: 'Skyridge',           num: '129' },
  { qty: 2, name: 'Miracle Sphere Beta',  set: 'Skyridge',           num: '130' },
  { qty: 2, name: 'Miracle Sphere Gamma', set: 'Skyridge',           num: '131' },
  { qty: 2, name: 'Oracle',               set: 'Skyridge',           num: '138' },
  { qty: 1, name: 'Town Volunteers',      set: 'Aquapolis',          num: '136' },
  { qty: 2, name: "Professor Oak's Research", set: 'Expedition Base Set', num: '149' },
  { qty: 4, name: 'Moo-Moo Milk',         set: 'Expedition Base Set', num: '155' },
];

// ── Build the decklist ─────────────────────────────────────────────
const lines = [];
let totalCards = 0;

// Count Pokemon and Trainers
let pokemonCount = 0;
for (const entry of pokemon) pokemonCount += entry.qty;
let trainerCount = 0;
for (const entry of trainers) trainerCount += entry.qty;

// Pokemon header
lines.push('****** Pokémon Trading Card Game Deck List ******');
lines.push('');
lines.push(`##Pokémon - ${pokemonCount}`);
lines.push('');

for (const entry of pokemon) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Trainers header
lines.push('');
lines.push(`##Trainer Cards - ${trainerCount}`);
lines.push('');

for (const entry of trainers) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Energy - using Sun & Moon basic energy
lines.push('');
lines.push('##Energy - 26');
lines.push('');
lines.push('* 11 Psychic Energy SUM 168');
lines.push('* 3 Fire Energy SUM 165');
lines.push('* 3 Lightning Energy SUM 167');
lines.push('* 3 Grass Energy SUM 164');
lines.push('* 3 Water Energy SUM 166');
lines.push('* 3 Fighting Energy SUM 169');
totalCards += 26;

lines.push('');
lines.push('Total Cards - ' + totalCards);
lines.push('');
lines.push('****** Deck List Generated by SimpleDex ******');
lines.push('');

const output = lines.join('\n');
console.log(output);

// Save to file
const outPath = path.join(__dirname, '..', 'decklists', 'mind-machine.txt');
fs.mkdirSync(path.dirname(outPath), { recursive: true });
fs.writeFileSync(outPath, output, 'utf8');
console.log(`\nSaved to: ${outPath}`);
