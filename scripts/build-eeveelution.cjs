#!/usr/bin/env node
/**
 * Build the "Eeveelution" theme deck (Skyridge) in PTCGO format.
 *
 * Looks up each card in cards-western.json by name, set, and number
 * to find the correct ptcgoCode, then outputs the formatted decklist.
 *
 * Saves to: decklists/eeveelution.txt
 */

const path = require('path');
const fs = require('fs');
const cards = require(path.join(__dirname, '..', 'dist', 'cards-western.json'));

// Helper: find a card by exact English name, set name, and card number
function findCard(name, setName, number) {
  const match = cards.find(c => {
    const cardName = c.names?.en || c.name || '';
    return cardName === name && c.set === setName && c.number === String(number);
  });
  if (!match) {
    console.error(`WARNING: Could not find card: ${name} | ${setName} | ${number}`);
    return null;
  }
  return match;
}

// Helper: format a PTCGO line
function ptcgoLine(qty, card) {
  const name = card.names?.en || card.name || '???';
  const code = card.ptcgoCode || card.set;
  const num = card.number;
  return `* ${qty} ${name} ${code} ${num}`;
}

// ── Deck Definition (Eeveelution - Skyridge) ──────────────────────
// Pokemon section
const pokemon = [
  { qty: 1, name: 'Flareon',     set: 'Skyridge', num: '8'   },  // Fire, Rare
  { qty: 3, name: 'Growlithe',   set: 'Skyridge', num: '62'  },  // Fire, Common
  { qty: 1, name: 'Jolteon',     set: 'Skyridge', num: '13'  },  // Lightning, Rare
  { qty: 2, name: 'Electrode',   set: 'Skyridge', num: '36'  },  // Lightning, Uncommon
  { qty: 3, name: 'Voltorb',     set: 'Skyridge', num: '113' },  // Lightning, Common
  { qty: 1, name: 'Vaporeon',    set: 'Skyridge', num: '33'  },  // Water, Rare
  { qty: 3, name: 'Lapras',      set: 'Skyridge', num: '71'  },  // Water, Common
  { qty: 4, name: 'Eevee',       set: 'Skyridge', num: '54'  },  // Colorless, Common
  { qty: 2, name: 'Teddiursa',   set: 'Skyridge', num: '109' },  // Colorless, Common
  { qty: 1, name: 'Ursaring',    set: 'Skyridge', num: '110' },  // Colorless, Common
];

// Trainer section
const trainers = [
  { qty: 2, name: 'Fast Ball',           set: 'Skyridge',             num: '124' },  // Uncommon
  { qty: 2, name: 'Fisherman',           set: 'Skyridge',             num: '125' },  // Uncommon
  { qty: 2, name: 'Town Volunteers',     set: 'Aquapolis',            num: '136' },  // Uncommon
  { qty: 3, name: "Bill's Maintenance",  set: 'Expedition Base Set',  num: '137' },  // Common
  { qty: 4, name: 'Potion',              set: 'Expedition Base Set',  num: '156' },  // Common
];

// ── Build the decklist ─────────────────────────────────────────────
const lines = [];
let totalCards = 0;

// Count Pokemon and Trainers
let pokemonCount = 0;
for (const entry of pokemon) pokemonCount += entry.qty;
let trainerCount = 0;
for (const entry of trainers) trainerCount += entry.qty;

// Pokemon header
lines.push('****** Pokémon Trading Card Game Deck List ******');
lines.push('');
lines.push(`##Pokémon - ${pokemonCount}`);
lines.push('');

for (const entry of pokemon) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Trainers header
lines.push('');
lines.push(`##Trainer Cards - ${trainerCount}`);
lines.push('');

for (const entry of trainers) {
  const card = findCard(entry.name, entry.set, entry.num);
  if (card) {
    lines.push(ptcgoLine(entry.qty, card));
    totalCards += entry.qty;
  }
}

// Energy
lines.push('');
lines.push('##Energy - 26');
lines.push('');
lines.push('* 9 Lightning Energy XY 135');
lines.push('* 9 Water Energy XY 134');
lines.push('* 8 Fire Energy XY 133');
totalCards += 26;

lines.push('');
lines.push('Total Cards - ' + totalCards);
lines.push('');
lines.push('****** Deck List Generated by SimpleDex ******');
lines.push('');

const output = lines.join('\n');
console.log(output);

// Save to file
const outPath = path.join(__dirname, '..', 'decklists', 'eeveelution.txt');
fs.mkdirSync(path.dirname(outPath), { recursive: true });
fs.writeFileSync(outPath, output, 'utf8');
console.log(`\nSaved to: ${outPath}`);
